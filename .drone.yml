kind: pipeline
name: default

steps:
- name: Run rspec
  image: ruby:2.6
  commands:
    - bundle
    - bundle exec rspec
  when:
   event:
    - pull_request

- name: Bump and Tag
  image: ruby:2.6
  environment:
    GITHUB_API_KEY:
      from_secret: kite_bot_key
  commands:
    - ruby ci/bump.rb
  when:
    event:
      - push
    branch:
      - 1-1-stable

- name: Publish to RubyGems
  image: ruby:2.6
  environment:
    RUBYGEMS_API_KEY:
      from_secret: rubygems_api_key
  commands:
    - bundle --jobs $(nproc)
    - bundle exec rake release
  when:
    event:
      - tag
